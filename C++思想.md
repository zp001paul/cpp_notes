# C++思想



## exception的坏处

很多人不喜欢异常，是因为它的默认行为是导致程序退出，其实这倒是没有什么问题的。

因为对于抛出异常的情况，比如发生了“除以0”的异常，发生了数组越界的异常，这时继续运行也是不对的，退出是正确的选择。

异常的不好的地方是以下几个问题。

## 1. 没产生足够的诊断信息

默认抛出异常不会告诉你程序运行到了哪一行，出错的相关变量信息是什么。给程序员造成了麻烦。一般异常是要在开发阶段杜绝的问题，所以快速定位bug所在是刚需，可惜C++默认不给这个便利。

## 2. 在多线程环境，异常会变成悄无声息

你创建一个线程，线程出了异常，导致线程退出，但是毫无痕迹，程序员甚至还不知道线程已经退出，还以为它在哪里卡住了。

## 3. 异常很容易被滥用

场景：我的程序要支持多个地方读配置文件，先在当前目录下面读my.conf，如果不存在就去/home/username/读my.conf

这时，判断当前目录文件不存在的时候，如果你抛个异常，真是不太好的设计，这本来就是一个简单的if语句的事，不应该用异常。

异常只能在以下场景下使用：

### 1. ctor中出错

### 2. 函数哨兵处

最常用的是函数开始前判断某个指针不能为空。这时很多人会使用assert()，但推荐使用一个设计良好的异常。因为assert()在release版本中是可以去掉的，但异常则一般不会去掉。

### 3. 标记程序的BUG的地方

最常用的，如果程序无缘无故地走到了不该走的地方。比如走到了一个enum class定义之外的值，这时抛个异常最好不过。

## 4. 报错信息不够友好

不能直接给程序的用户看到的，太丑陋了。

